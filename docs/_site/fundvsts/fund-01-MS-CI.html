<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>PartsUnlimitedMRP : Continuous Integration</title>
        <meta name="description" content="DevOps Hands On Labs">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/PartsUnlimitedMRP/css/syntax.css">
        <link rel="stylesheet" href="/PartsUnlimitedMRP/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <img class="logo" src="http://julienstroheker.github.io/PartsUnlimitedMRP/assets/logo-ms-dark.png" alt="Microsoft">
<h4><a class="brand" href="/PartsUnlimitedMRP/">PartsUnlimitedMRP</a>
    <small>DevOps Hands On Labs</small>
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3">
                        <ul class="nav nav-list">
    
        <li><a href="/PartsUnlimitedMRP/">Welcome</a></li>
    

    
        
        

        
            
                <li class="nav-header">Fundamentals using Visual Studio Team Services</li>
            

            
                <li data-order="7"><a href="/PartsUnlimitedMRP/fundvsts/fund-05-MS-LoadTest.html">Auto-Scale & Load Tests</a></li>
            
        
            

            
                <li data-order="6"><a href="/PartsUnlimitedMRP/fundvsts/fund-04-MS-tests.html">Testing with VSTS and Eclipse</a></li>
            
        
            

            
                <li data-order="5"><a href="/PartsUnlimitedMRP/fundvsts/fund-03-MS-APM.html">Application Performance Monitoring</a></li>
            
        
            

            
                <li data-order="4"><a href="/PartsUnlimitedMRP/fundvsts/fund-02-MS-CDAgent.html">Continuous Deployment with Remote Agent</a></li>
            
        
            

            
                <li data-order="3"><a href="/PartsUnlimitedMRP/fundvsts/fund-02-MS-CD.html">Continuous Deployment with Hosted agent</a></li>
            
        
            

            
                <li data-order="2"><a class="nav-active" href="/PartsUnlimitedMRP/fundvsts/fund-01-MS-CI.html">Continuous Integration</a></li>  
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimitedMRP/fundvsts/fund-0-MS-prereq.html">Set up Parts Unlimited MRP</a></li>
            
        
    
        
        

        
            
                <li class="nav-header">Fundamentals using Other Tools</li>
            

            
                <li data-order="5"><a href="/PartsUnlimitedMRP/fundoth/fund-14-Oth-chef.html">Continuous Deployment with Chef</a></li>
            
        
            

            
                <li data-order="4"><a href="/PartsUnlimitedMRP/fundoth/fund-13-Oth-puppet.html">Continuous Deployment with Puppet</a></li>
            
        
            

            
                <li data-order="3"><a href="/PartsUnlimitedMRP/fundoth/fund-12-Oth-CD.html">Continuous Deployment with Jenkins</a></li>
            
        
            

            
                <li data-order="2"><a href="/PartsUnlimitedMRP/fundoth/fund-11-Oth-CI.html">Continuous Integration with Jenkins</a></li>
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimitedMRP/fundoth/fund-10-Oth-prereq.html">Set up Parts Unlimited MRP</a></li>
            
        
    
        
        

        
    
        
        

        
            
                <li class="nav-header">Advanced</li>
            

            
                <li data-order="1"><a href="/PartsUnlimitedMRP/adv/adv-21-Docker.html">Microservices with Docker</a></li>
            
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-9">
                        <div class="page-header">
    <h2>Continuous Integration
        
    </h2>
</div>

<h3 id="parts-unlimited-mrp-app-continuous-integration-with-vsts-build">Parts Unlimited MRP App Continuous Integration with VSTS Build</h3>

<p>In this lab, we have an application called Parts Unlimited MRP. We want to set up
Visual Studio Team Services to be able continuously integrate code into the master
branch of code. This means that whenever code is committed and pushed to the
master branch, we want to ensure that it integrates into our code correctly to
get fast feedback. To do so, we are going to be creating a build definition that
will allow us to compile and run unit tests on our code every time a commit is
pushed to Visual Studio Team Services.</p>

<h3 id="pre-requisites">Pre-requisites:</h3>

<ul>
  <li><a href="https://github.com/Microsoft/PartsUnlimitedMRP/blob/master/docs/HOL_Set-Up-MRP/README.md">Completion of the “Set up Parts Unlimited MRP” lab</a></li>
  <li>Project Administrator rights to the Visual Studio Team Services account</li>
</ul>

<h3 id="tasks-overview">Tasks Overview:</h3>

<p><strong>Create a Continuous Integration Build:</strong> In this step, you will create a build definition in Visual Studio Team Services that will be triggered every time a commit is pushed to your repository in Visual Studio Team Services.</p>

<h3 id="create-a-continuous-integration-build">1. Create a Continuous Integration Build</h3>

<blockquote>
  <p>NOTE: Ensure that you have an existing PartsUnlimitedMRP team project that also contains the Git repository cloned from GitHub. If not, complete the <a href="https://github.com/Microsoft/PartsUnlimitedMRP/blob/master/docs/HOL_Set-Up-MRP/README.md">“Set up Parts Unlimited MRP”</a> lab before going through this lab.</p>
</blockquote>

<blockquote>
  <p>In this lab, we will be using the Hosted agent located in Visual Studio Team Services. If you would like to use an on-premises cross-platform agent (Azure subscription needed), you can follow instructions for setting an agent up <a href="https://www.visualstudio.com/en-us/docs/build/admin/index">with this link</a>.</p>
</blockquote>

<p>A continuous integration build will give us the ability to automate whether the code
we checked in can compile and will successfully pass any automated tests that we
have created against it. By using an automated build pipeline, we can quickly validate if our code changes have “broken the build” and fix code before it gets to production.</p>

<p><strong>1.</strong> Go to your <strong>account’s homepage</strong>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>https://&lt;account&gt;.visualstudio.com **2.** Click **Browse** (if necessary), select your team project and click **Navigate**.
</code></pre>
</div>

<p><img src="../assets/ci/navigate_to_project.png" alt="" /></p>

<p><strong>3.</strong> Once on the project’s home page, click on the <strong>Build</strong> hub at the top of
the page.</p>

<p><img src="../assets/ci/build_tab.png" alt="" /></p>

<p><strong>4.</strong> Click the <strong>+ New Definition</strong> button (or the <strong>green “plus” sign</strong> or the <strong>+ New</strong> link), select <strong>Empty</strong>, and then click <strong>Next &gt;</strong>.</p>

<p><img src="../assets/ci/new_empty_build.png" alt="" /></p>

<p><strong>5.</strong> Ensure the Team Project is selected as the <strong>Repository source</strong>, the appropriate repository (created in the previous step), and select “Hosted” as the <strong>Default agent queue</strong>, then click <strong>Create</strong>.</p>

<p><img src="../assets/ci/build_select_repo.png" alt="" /></p>

<p><strong>6.</strong> Click on the <strong>Build</strong> tab, click <strong>Add build step…</strong>, and then click the <strong>Add</strong> button three times next to the Gradle task to add three Gradle tasks to the script. Gradle will be used to build the Integration Service, Order Service, and Clients components of the MRP app.</p>

<p><img src="../assets/ci/build_add_gradle.png" alt="" /></p>

<p><strong>6.</strong> Select the first Gradle task and <strong>click the pencil icon</strong> to edit the task name. Name the task <em>IntegrationService</em> and set the <strong>Gradle Wrapper</strong> to the following location (either type or browse using the <strong>…</strong> button):</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/Backend/IntegrationService/gradlew
</code></pre>
</div>

<p><img src="../assets/ci/build_gradle_integration.png" alt="" /></p>

<p><strong>7.</strong> Uncheck the checkbox in <strong>JUnit Test Results</strong> to Publish to TFS/Team Services since we will not be running automated tests in the Integration Service. Expand the <strong>Advanced</strong> section, and set the <strong>Working Directory</strong> to the following location:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/Backend/IntegrationService
</code></pre>
</div>

<p><img src="../assets/ci/build_working_directory_integration.png" alt="" /></p>

<p><strong>8.</strong> Select the second Gradle task and <strong>click the pencil icon</strong> to edit the task name. Name the task <em>OrderService</em> and set the <strong>Gradle Wrapper</strong> to the following location:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/Backend/OrderService/gradlew
</code></pre>
</div>

<p><img src="../assets/ci/build_gradle_order.png" alt="" /></p>

<p><strong>9.</strong> Since Order Service does have unit tests in the project, we can automate running the tests as part of the build by adding in <code class="highlighter-rouge">test</code> in the <strong>Gradle tasks</strong> field. Keep the <strong>JUnit Test Results</strong> checkbox to “Publish to TFS/Team Services” checked, and set the <strong>Test Results Files</strong> field to <code class="highlighter-rouge">**/TEST-*.xml</code>.</p>

<p>Expand the <strong>Advanced</strong> section, and set the <strong>Working Directory</strong> to the following location:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/Backend/OrderService
</code></pre>
</div>

<p><img src="../assets/ci/build_working_directory_order.png" alt="" /></p>

<p><strong>10.</strong> Select the third Gradle task and <strong>click the pencil icon</strong> to edit the task name. Name the task <em>Clients</em> and set the <strong>Gradle Wrapper</strong> to the following location:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/Clients/gradlew
</code></pre>
</div>

<p><img src="../assets/ci/build_gradle_clients.png" alt="" /></p>

<p><strong>11.</strong> Uncheck the checkbox in <strong>JUnit Test Results</strong> to Publish to TFS/Team Services since we will not be running automated tests in Clients. Expand the <strong>Advanced</strong> section, and set the <strong>Working Directory</strong> to the following location:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>src/Clients
</code></pre>
</div>

<p><img src="../assets/ci/build_working_directory_clients.png" alt="" /></p>

<p><strong>9.</strong> Click <strong>Add build step…</strong>, select the <strong>Utility</strong> tab, and add two <strong>Copy and Publish Build Artifacts</strong> tasks.</p>

<p><img src="../assets/ci/build_add_pub_step.png" alt="" /></p>

<p><strong>10.</strong> Select the first Publish Build Artifacts task, and fill in the input values with the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Copy Root: $(Build.SourcesDirectory)
Contents: **/build/libs/!(buildSrc)*.?ar
Artifact Name: drop
Artifact Type: Server
</code></pre>
</div>

<p><img src="../assets/ci/build_pub_step_details.png" alt="" /></p>

<p><strong>11.</strong> Select the second Publish Build Artifacts task, and fill in the input values with the following:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>Copy Root: $(Build.SourcesDirectory)
Contents: **/deploy/SSH-MRP-Artifacts.ps1
		  **/deploy/deploy_mrp_app.sh
          **/deploy/MongoRecords.js
Artifact Name: deploy
Artifact Type: Server
</code></pre>
</div>

<p><img src="../assets/ci/second_copy_publish.png" alt="" /></p>

<p><strong>12.</strong> Go to the <strong>Triggers</strong> tab and <strong>select Continuous Integration (CI)</strong>.</p>

<p><img src="../assets/ci/build_ci_trigger.png" alt="" /></p>

<p><strong>13.</strong> Click <strong>General</strong>, set the default queue to the appropriate queue. Leave as the <strong>Hosted</strong> queue from the previous steps.</p>

<p><img src="../assets/ci/build_general.png" alt="" /></p>

<p><strong>14.</strong> Click <strong>Save</strong>, give the build definition a name (i.e.
<em>PartsUnlimitedMRP.CI</em>), and then click <strong>OK</strong>.</p>

<p><img src="../assets/ci/build_save.png" alt="" /></p>

<p><strong>15.</strong> Go to the <strong>Code</strong> tab, select the <strong>index.html</strong> file located at
src/Clients/Web, and click <strong>Edit</strong>.</p>

<p><img src="../assets/ci/edit_index_web.png" alt="" /></p>

<p><strong>16.</strong> Change the &lt;title&gt; on line 5 to <strong>Parts Unlimited MRP</strong> and 
click the <strong>Save button</strong>.
<img src="../assets/ci/save_index.png" alt="" /></p>

<p><strong>17.</strong> This should have triggered the build definition we previously created. Click the <strong>Build</strong> tab to see the build in action.
Once complete, you should see build summary similar to this, which includes test results:</p>

<p><img src="../assets/ci/build_summary.png" alt="" /></p>

<p><img src="../assets/ci/build_summary_2.png" alt="" /></p>

<h2 id="next-steps">Next steps</h2>

<p>In this lab, you learned how to create a Continuous Integration build that runs when new commits are pushed to the master branch. This allows you to get feedback as to whether your changes made breaking syntax changes, or if they broke one or more automated tests, or if your changes are okay. Try these labs out for next steps:</p>

<ul>
  <li>
    <p><a href="https://github.com/Microsoft/PartsUnlimitedMRP/tree/master/docs/HOL_Continuous-Deployment">HOL Parts Unlimited MRP Continuous Deployment </a></p>
  </li>
  <li>
    <p><a href="https://github.com/Microsoft/PartsUnlimitedMRP/tree/master/docs/HOL_Automated-Testing">HOL Parts Unlimited MRP Automated Testing</a></p>
  </li>
  <li>
    <p><a href="https://github.com/Microsoft/PartsUnlimitedMRP/tree/master/docs/HOL_Application-Performance-Monitoring">HOL Parts Unlimited MRP Application Performance Monitoring</a></p>
  </li>
</ul>

<h1 id="continuous-feedbacks">Continuous Feedbacks</h1>

<h4 id="issues--questions-about-this-hol-">Issues / Questions about this HOL ??</h4>

<p><a href="https://github.com/Microsoft/PartsUnlimitedMRP/issues">If you are encountering some issues or questions during this Hands on Labs, please open an issue by clicking here</a></p>

<p>Thanks</p>


                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/Microsoft/PartsUnlimitedMRP">PartsUnlimitedMRP</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
